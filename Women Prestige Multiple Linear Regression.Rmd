---
title: "Multiple Linear Regression"
author: "JP"
date: "6/15/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
library(readr)
df <- read_csv("Women_Prestige_Data.csv")
head(df)
```

```{r}
# Checking data type:
str(df)
```
```{r}
# Data distribution:
library(purrr)
library(tidyr)
library(ggplot2)
par(mfrow= c(3, 3))
df %>%
  keep(is.numeric) %>% subset(select=-c(census))%>%
  gather() %>% 
  ggplot(aes(value)) +
    facet_wrap(~ key, scales = "free") +
    geom_histogram(aes(y = ..count..), bins=12, fill = "grey") +
    stat_function(fun = dnorm)
    
```

## Including Plots

You can also embed plots, for example:

```{r}
# Graphs to check data distribution:
# Create a function that helps create graphs:
histDenNorm <- function (x, main = "") {
   hist(x, prob = TRUE, main = main) # Histogram
   lines(density(x), col = "blue", lwd = 2) # Density 
   x2 <- seq(min(x), max(x), length = 40)
   f <- dnorm(x2, mean(x), sd(x))
   lines(x2, f, col = "red", lwd = 2) # Normal
   legend("topright", c("Density", "Normal"), box.lty = 3,
          lty = 3, col = c("blue", "red"), lwd = c(1, 2, 2))
}
png(file="images/R graphs.png",
width=600, height=350)
x <- df$education
y <- df$income
z <- df$women
v <- df$prestige
par(mfrow= c(2,2))
histDenNorm(x, main = "education")
histDenNorm(y, main = "income")
histDenNorm(z, main = "women")
histDenNorm(v, main = "prestige")
dev.off()
```
```{r}
# Correlation heatmap:
library(psych)
png(file="images/R heatmap.png",
width=600, height=350)
df1 <- subset(df, select=-c(census, occupation_name, type))
corPlot(df1, cex = 1.2, numbers=TRUE,stars=TRUE)
dev.off()
```
```{r}
# Linear regression
full.model <- lm(prestige ~ education + income + women, data=df)
reduced.model <- step(full.model, direction = "backward")
summary(reduced.model)
```
```{r}
fit <- lm(prestige ~ education + income + women, data=df)
summary(fit)
```
```{r}
# diagnostic plots
png(file="images/R diagnostic plots.png",
width=600, height=350)
layout(matrix(c(1,2,3,4),2,2)) # optional 4 graphs/page
plot(fit)
dev.off()
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
